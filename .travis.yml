matrix:
  include:
    - language: python
      name: "Backend Tests"
      python:
       - 3.6
      services: postgresql
      addons:
        postgresql: "9.4"
      before_install:
        - export DJANGO_SETTINGS_MODULE=config.settings.test
        - source .envrc.travis
      install:
        - pip install -r requirements/local.txt
      before_script:
        - psql -c "CREATE DATABASE travisci;" -U postgres
      script:
        - coverage run --omit='*/tests/*,*/migrations/*'  --source='ozone' manage.py test --keepdb
      after_success:
        - pip install python-coveralls
        - coveralls
    - language: node_js
      name: "Frontend Tests"
      services:
      addons:
      node_js:
        - node
      install:
        - cd frontend && yarn install
      before_script:
      script:
        - npm run testNoWatch
    - language: python
      name: "Update ozone-translations"
      python:
        - 3.6
      services: postgresql
      addons:
        postgresql: "9.4"
      before_install:
        - if ! [[ $TRAVIS_BRANCH = 'develop' && $TRAVIS_PULL_REQUEST = 'false' ]]; then exit 0; fi
        - export DJANGO_SETTINGS_MODULE=config.settings.test
        - source .envrc.travis
      install:
        - pip install -r requirements/local.txt
      before_script:
        - psql -c "CREATE DATABASE travisci;" -U postgres
      script:
        - git clone https://github.com/eaudeweb/ozone-translations.git translations
        - python manage.py makemessages
        - utility/push_from_travis.sh
env:
  global:
    secure: V8t8Vy7HP0jaKkV+75HfgHHmuw3zQ8uL/qxuNBi3h04TLjwjiJWY1C2z19lSuRN8MyNExmbPinVqNBsrDzgEKK7NUjH+2Xm0hyafwS63A7E2cP2QhF5Z1F886tj6EXPJ40zt2lG3t6X7YSC4ofs4klwPDPjlakmc95TjuCS87gREkAVNil3DsRLH5jrO89jOZ0eAF9B5oKhN+KTWbkjk9NbTYnwzW3Lcl2Ol7Qjy8uwQd5KB2D2Mt57U63Vuc+8PAX+D1bsU27c+1G0cfz9AeGXK+i8HL4FIYPrUT0TBNor41O8ofNUwnmbGiyO9WwoRANF1DsdLPP0bK3l3I3ovB26ophqkp5sPF+/ptL5zBeaqdjZaElXx7RNqyU6aTJQSYc+uy6hd8iQTU5Pf+G5cp52SAeNz09HC5Rl8RcZ6QpvV7Bm+qyPXt9FKKH1I5s5+hLahdLi4zJPvKBEgTVz4NpEcpC3BlBKI4FuYLpRgl8/h9FGAob4Yr8KkI3MGEqBIHCI3KMU4kOusA7g0SmtXTiNZTmkSpxfyIvN3u9evVPoNKa4G7r+hDcTKUGrzMw0M+/ImSTfyvbDncA17SjhJLfFk0/X0k0V5XDMN8PSQi2K1UXEhmjulvo33r9IoUiLnJKkHf0LxSwQb5CyHs6kCTrXdCBUSzzjtlG86Oy1bZLc=
